!function(e,t,n,a,i,o,r){"use strict";var s=s||void 0,l={youtubeObjects:{},getDateTimeFormat:function(){return"YYYY-MM-DD HH:mm:ss"},getYouTubePlayer:function(e){return this.youtubeObjects[e]},hasYouTubePlayer:function(e){return!n.isUndefined(this.youtubeObjects[e])},destroyYouTubePlayer:function(e){this.hasYouTubePlayer(e)&&this.getYouTubePlayer(e).hasOwnProperty("destroy")&&this.youtubeObjects[e].destroy()},getPeriodOfDay:function(){var e=parseFloat(a().format("H"));return e>=5.5&&e<=12?"morning":e>12&&e<=16.5?"afternoon":e>16.5&&e<=21?"evening":"night"},isValidURL:function(e){return/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},textFormatter:function(e){return parseInt(e).toLocaleString()},getManyCss:function(e,n,a){void 0===a&&(a=!1),t.when(t.each(e,function(e,n){a&&(n+="?_ts="+(new Date).getTime()),t.get(n,function(){t("<link>",{rel:"stylesheet",type:"text/css",href:n}).appendTo("head")})})).then(function(){"function"==typeof n&&n()})},setYouTubePlayer:function(t,a){var i=this;o.load("https://www.youtube.com/iframe_api",function(){var o=function(n){i.youtubeObjects[t]=new e.YT.Player(t,{height:"227",width:"470",playerVars:{autoplay:1},events:{onReady:function(e){n(e.target)},onStateChange:function(n){try{n.data===e.YT.PlayerState.ENDED&&i.youtubeObjects[t].playVideo()}catch(e){r(e)}}}})};if(n.isUndefined(e.onYouTubeIframeAPIReady))e.onYouTubeIframeAPIReady=function(){o(a)};else try{if(n.isUndefined(i.youtubeObjects[t]))o(a);else try{a(i.youtubeObjects[t])}catch(e){o(a)}}catch(e){o(a)}})},fixJsonBooleans:function(e,t){return n.each(t,function(t){if(-1!==t.indexOf(".")){var n=t.split(".");e[n[0]][n[1]]="false"!==e[n[0]][n[1]]}else e[t]="false"!==e[t]}),e},fixJsonIntegers:function(e,t){return n.each(t,function(t){if(-1!==t.indexOf(".")){var n=t.split(".");e[n[0]][n[1]]=parseInt(e[n[0]][n[1]])}else e[t]=parseInt(e[t])}),e},fixJson:function(e,t,a){return n.each(t,function(t){if(-1!==t.indexOf(".")){var n=t.split(".");e[n[0]][n[1]]=a.call(this,e[n[0]][n[1]])}else e[t]=a.call(this,e[t])}),e}},u={DarkMode:{toggle:function(e){e?this.set():this.unset()},set:function(){t("body").toggleClass("dark-mode",!0),t(".night-day-mode-switch").find(".onoffswitch-checkbox").prop("checked",!0)},unset:function(){t("body").toggleClass("dark-mode",!1),t(".night-day-mode-switch").find(".onoffswitch-checkbox").prop("checked",!1)}},SnackBar:{timer:null,show:function(e){var a=t("#snackbar");n.isNull(this.timer)||(clearTimeout(this.timer),a.removeClass("show")),a.addClass("show"),a.find(".snackbar-inner").html(e),this.timer=setTimeout(function(){t("#snackbar").removeClass("show")},3750)}},Preloader:{set:function(e,t){t=n.isObject(t)?t:{},e.find(".preloader").length&&this.remove(e);var a=e.outerHeight()-(t.top?parseFloat(t.top.replace("px","")):0);e.append('<div class="preloader"><img src="img/ring.svg"></div>'),e.find(".preloader").css({height:a+"px",top:t.top?t.top:0}),e.data("preloader-callback",t.callback)},remove:function(e){var t=e.data("preloader-callback");n.isFunction(t)&&t(),e.find(".preloader").remove()}},Tabs:{open:function(e,n){var a,i,o;if(s.TuneManager.CurrentPlayingSound.stopCurrentPlayer(),null!==document.getElementById(n)&&0!==document.getElementById(n).length){for(i=document.getElementById(n).getElementsByClassName("v-tab-content"),a=0;a<i.length;a++)i[a].style.display="none";for(o=document.getElementById(n).getElementsByClassName("v-tab-links"),a=0;a<o.length;a++)o[a].className=o[a].className.replace(" active","");document.querySelector("#"+n+" #"+e).style.display="block",t(".v-"+e).addClass("active")}}},Tippy:{reference:[],refresh:function(){this.reference=e.tippy(".tippy")}},init:function(){this._bindInitialEvents()},_bindInitialEvents:function(){this.bindPlayers(),this.bindIntroJS()},bindIntroJS:function(){t(".btn-help").on("click",function(){s.GAnalytics.app("Help","open"),o.load(["js/vendor/intro.min.js","css/vendor/introjs.min.css"],function(){e.introJs().start()})})},bindPlayers:function(){var e=s.TuneManager,a=function(t){var a=t.data("src");e.CurrentPlayingSound.replaceAndStart(a,t,function(){var e=t.find(".text-play");!n.isUndefined(e)&&n.isUndefined(e.attr("disable-play-text"))&&t.find(".text-play").text("Playing"),t.addClass("playing")},function(){var e=t.find(".text-play");t.removeClass("playing"),!n.isUndefined(e)&&n.isUndefined(e.attr("disable-play-text"))&&t.find(".text-play").text("Play")})};t(".play-wrapper").unbind("click.mc").bind("click.mc",function(i){var o=t(this);i.stopPropagation();var r=o.find(".text-play");if(e.CurrentPlayingSound.isActive()){e.CurrentPlayingSound.$dom.removeClass("playing");var s=e.CurrentPlayingSound.isDom(o);r.length&&n.isUndefined(r.attr("disable-play-text"))&&r.text("Play"),s?e.CurrentPlayingSound.setInactive():a(o)}else a(o),n.isUndefined(r.attr("disable-play-text"))&&r.text("Loading"),o.addClass("playing")})}},d={$document:t(document),on:function(e,t,n){"function"==typeof t?this.$document.on(e,t):(t="object"==typeof t?t:{},this.$document.on(e,t,n))},emit:function(e,t){n.isUndefined(t)&&(t=[]),n.isArray(t)||(t=[t]),this.$document.trigger(e,t)}},c={app:function(t,n){e.ga("send",{hitType:"event",eventCategory:"Application",eventAction:t,eventLabel:n})},games:function(t,n){e.ga("send",{hitType:"event",eventCategory:"Games",eventAction:t,eventLabel:n})}},m={_ajax:function(e,a,i){return t.ajax({url:"/api"+e,data:{params:n.isUndefined(a)?[]:a},type:i,dataType:"json"})},GET:function(e,t){return this._ajax(e,t,"GET")},POST:function(e,t){return this._ajax(e,t,"POST")},PUT:function(e,t){return this._ajax(e,t,"PUT")},DELETE:function(e,t){return this._ajax(e,t,"DELETE")}},f={openDialog:function(e){var n=null;t.alert({title:"Can't sleep? Play some games",content:"url:partials/games/games.html",escapeKey:!0,type:"blue",backgroundDismiss:!1,onContentReady:function(){void 0!==e&&(n=setTimeout(function(){t("#games-dialog").find('img[data-id="'+e+'"]').trigger("click")},400),s.GAnalytics.games("Window","open"))},onClose:function(){clearTimeout(n)},buttons:{Close:{text:"Close"}},boxWidth:"880px",useBootstrap:!1})},init:function(){var e=this;t(".game-link").on("click",function(n){n.preventDefault();var a=t(this).data("game-id");e.openDialog("all"===a?void 0:a)}),t("#play-games").on("click",function(t){t.preventDefault(),e.openDialog()})}},g={$cont:null,fetchOffset:0,initialized:!1,init:function(){this.$cont=t(".widget-box.just-woke-up > ul"),this.fetch(),setInterval(this.fetch,3e5),this.$cont.on("scroll",function(){t(this).scrollTop()+t(this).innerHeight()>=t(this)[0].scrollHeight&&(s.JWUManager.fetchOffset+=15,s.JWUManager.fetch(!0))})},fetch:function(e){e=!n.isUndefined(e)&&e,s.Backend.GET("/just-woke-up?async=true&offset="+s.JWUManager.fetchOffset).done(function(i){this.initialized=!0,e||s.JWUManager.$cont.find("li:not(.mock-just-woke-up)").remove(),s.JWUManager.currentOffset+=15,n.each(i.items,function(e){var n=s.JWUManager.$cont.find(".mock-just-woke-up").clone(),o=JSON.parse(e.tune_data),r=(a(e.time_setted,"YYYY-MM-DD HH:mm:ss"),"");switch(e.tune_type){case"youtube":r="with YouTube";break;case"tune":r=s.TuneManager.getMoodByCategory(o.category);break;case"radio":r="to a radio song";break;case"upload":r="to an uploaded tune"}n.removeClass("mock-just-woke-up");var l=null===e.picture||""===e.picture?"https://graph.facebook.com/"+e.fbid+"/picture?type=square":e.picture;switch(n.find(".image-wrapper img").attr("src",l),n.find(".name-and-title").find(".text-name").text(e.firstname),n.find(".name-and-title").find(".mood").text(r),n.find(".listened-to").find(".tune-name-text").text(o.title),e.tune_type){case"tune":n.find(".play-wrapper").data("src",o.src);var u=n.find(".like-unlike-wrapper");s.LikesController.updateDomData(u,o),u.show();break;case"youtube":n.find(".like-unlike-wrapper").remove();var d,c;try{c=JSON.parse(e.tune_data),d=c.title,c.id}catch(e){c={id:"T0VLuLzIrH8",title:d="MetaClock Your Online Alarm Clock"}}var m=n.find(".play-wrapper");m.after('<div class="youtube-wrapper"><img class="box-svg svg-tune-type svg-youtube" src="img/youtube.svg" alt="YouTube" style="width: 17px;height: 17px;"> <span>'+d+"</span></div>");var f=m.closest(".tune-name"),g=m.parent().find(".youtube-wrapper");g.data("youtube_tune_data",c),f.css({display:"inline-block"}),m.remove(),g.on("click",function(){s.TuneManager.Dialog.openYouTubeVideo(t(this).data("youtube_tune_data"))});break;case"radio":break;case"upload":n.find(".like-unlike-wrapper").remove(),n.find(".tune-name").remove(),n.find(".name-and-title").css("vertical-align","6px")}if(e.hasOwnProperty("server_time_setted")&&e.hasOwnProperty("server_wake_up_time")&&null!==e.server_time_setted&&null!==e.server_wake_up_time){var h=i.server_time,p=e.server_wake_up_time,y=a.duration(a(h).diff(a(p))),v=a().subtract(y);n.find(".time-text").text(v.fromNow()),s.JWUManager.$cont.append(n),"tune"===e.tune_type&&s.UI.bindPlayers()}}),s.UI.Tippy.refresh()}).always(function(e,t){})}},h={init:function(){var e=this;t(".quote-box .refresh-quote").on("click",function(){e.fetch()}),e.fetch()},fetch:function(){var e=t(".quote-box");s.UI.Preloader.set(e),s.Backend.GET("/get-random-quote?async=true").done(function(t){e.find(".quote-text").text(t.text),e.find(".author").text("- "+t.author)}).always(function(t,n){s.UI.Preloader.remove(e),"error"===n&&(e.find(".quote-text").text("Things may come to those who wait, but only the things left by those who hustle."),e.find(".author").text("- Unknown"))})}},p={defaultData:{is_logged_in:!1,fbid:null,firstname:"Guest",lastname:"",email:"",picture:"https://www.metaclock.com/img/user.png"},getPictureURL:function(){return this.data.picture},getFirstName:function(){return this.data.firstname},getTuneBasePath:function(){return"uploads/"+s.User.getUserId()+"/"},data:{},getUserId:function(){return this.data.fbid},isLoggedIn:function(){return this.data.is_logged_in},getData:function(){return this.data},applyData:function(e){this.data=n.merge(n.clone(this.defaultData,!0),e),this.isLoggedIn()?this._applyDataToHeader():this._applyDefaultHeader()},setLoggedIn:function(e){var t=this;this.data.is_logged_in=!0,t.applyData(e)},openLoggingInDialog:function(e,a){return n.isUndefined(e)&&r("Serious error - userID is undefined"),t.dialog({title:!1,content:'<div style="display:inline-block"><img class="user-image" src="https://graph.facebook.com/'+e+'/picture?type=square" style="display: inline; width: 49px;"></div><div style="display: inline-block; font-size: 16px;margin-left: 11px;margin-top: 15px;">Loading your personal settings...</div>',escapeKey:!1,onOpen:a,closeIcon:!1,type:"blue",backgroundDismiss:!1,boxWidth:"370px",useBootstrap:!1})},setLoggedOut:function(){this.applyData(this.defaultData)},init:function(n){var a=this;this.applyData(n||this.defaultData),t(".ppl-num").text(s.Utils.textFormatter(e.initValues.people_count)),t(".btnLoginFacebook").on("click",this.login),t(".btnLogout").on("click",this.logout),s.EventManager.on("User.logged-out",function(e){a.setLoggedOut.apply(a,e)})},shareTune:function(){e.FB.ui({method:"share",href:"https://www.metaclock.com"},function(e){r(message)})},_applyDataToHeader:function(){t(".header-content .user-image").attr("src",s.User.getPictureURL()).show(),t(".header-content .user-name").show().find(".text-name").text(this.data.firstname),t(".header-content .greeting").text("Good "+l.getPeriodOfDay()),t(".header-content .login-btn-wrapper").hide()},_applyDefaultHeader:function(){t(".header-content .user-image").hide(),t(".header-content .user-name").hide(),t(".header-content .user-name").hide(),t(".header-content .btnLoginFacebook").show(),t(".header-content .login-btn-wrapper").show()},login:function(t,a,i){i=void 0===i||i;var o=function(e,t){var a=s.User.openLoggingInDialog(e.userID,function(){var i=m.POST("/complete-login",{authResponse:e,data:s.getData()}).done(function(e){s.setData(e),n.isFunction(t)&&t.call(),e.hasOwnProperty("is_new_user")&&e.is_new_user&&s.GAnalytics.app("New user"),s.EventManager.emit("User.logged-in")});i.fail(function(e){s.ErrorHandler.error("Apologies, logging-in is not be available at the moment. Please try again later."),r(e)}),i.always(function(){a.close()})})};e.FB.getLoginStatus(function(t){if("connected"!==t.status){if(!i)return;e.FB.login(function(e){"unknown"!==e.status&&o(e.authResponse,a)})}else o(t.authResponse,a)})},logout:function(){e.FB.getLoginStatus(function(t){t.authResponse?m.GET("/complete-logout",function(){try{e.FB.logout(function(e){r("fb logout:",e),s.EventManager.emit("User.logged-out")})}catch(e){r(e),s.EventManager.emit("User.logged-out")}}):s.EventManager.emit("User.logged-out")})}},y={likesArray:null,userLikes:null,updateDomData:function(e,t){e.data("tune_data",t),this.bindLikeEvent(e,t)},bindLikeButtons:function(){var e=this;t(".like-unlike-wrapper").each(function(){var n=t(this),a=n.data("tune_data");if(void 0===a)return!0;e.setLikeUnlikeDom(n,a),e.bindLikeEvent(n,a)})},setLikeUnlikeDom:function(e,t){var a=this,i=!1,o=!n.isNull(a.likesArray)&&!n.isUndefined(a.likesArray)&&!n.isUndefined(a.likesArray[t.id]);e.find(".like-count").text(o?s.Utils.textFormatter(a.likesArray[t.id].likes):0),n.each(a.userLikes,function(e){if(parseInt(e)===parseInt(t.id))return i=!0,!0}),s.User.isLoggedIn()&&i?e.addClass("did-liked"):e.removeClass("did-liked")},bindLikeEvent:function(e,t){var n=this;n.setLikeUnlikeDom(e,t),e.find(".svg-like-unlike").unbind("click.mc").bind("click.mc",function(a){n.likeEvent(e,t),a.stopPropagation()})},likeEvent:function(e,t){e.hasClass("did-liked")?s.LikesController.removeLike(e,t.id):s.LikesController.addLike(e,t.id)},removeLike:function(e,t){var a=this;s.User.isLoggedIn()?(e.removeClass("did-liked"),s.Backend.POST("/unlike-tune",{tune_id:t}).done(function(i){a.likesArray[t]=i,a.userLikes=n.filter(a.userLikes,function(e){return parseInt(e)!==parseInt(t)}),e.find(".like-count").text(s.Utils.textFormatter(i.likes)),s.EventManager.emit("Likes.count-update",t)}).fail(function(){e.addClass("did-liked")})):e.removeClass("did-liked")},addLike:function(e,t){var n=this,a=function(){e.addClass("did-liked"),s.Backend.POST("/like-tune",{tune_id:t}).done(function(a){n.likesArray[t]=a,n.userLikes.push(parseInt(t)),e.find(".like-count").text(a.likes),s.EventManager.emit("Likes.count-update",t)}).fail(function(){e.removeClass("did-liked")})};s.User.isLoggedIn()?a():s.ErrorHandler.loginPrompt("Please connect with Facebook to like this tune.",a)},init:function(){var e=this;s.EventManager.on("User.logged-out",e.fetchAndBind.bind(e)),s.EventManager.on("User.logged-in",e.fetchAndBind.bind(e)),s.EventManager.on("Likes.count-update",e.fetchAndBind.bind(e)),this.fetchAndBind()},fetchAndBind:function(){var e=this;s.Backend.GET("/get-likes").done(function(t){e.likesArray=t.likesArray,e.userLikes=t.userLikes,e.bindLikeButtons()}).always(function(){})}},v={init:function(){var e=t(".btn-use-my-location");"geolocation"in navigator?e.on("click",this.fetchLocation.bind(this,this.parseData,function(){s.ErrorHandler.error("Sorry, your location could not be detected. You might have blocked MetaClock from using your location. Please unblock it in your browser settings and try again.")})):e.on("click",function(){s.ErrorHandler.error("Sorry, your browser does not support geo-locations.")}),d.on("Alarm.wakeUp",function(){s.WeatherManager.loadWeather()}),d.on("User.logged-in",function(){s.WeatherManager.loadWeather()}),this.loadWeather()},parseData:function(e){s.SettingsController.data.weather.lat=e.coords.latitude,s.SettingsController.data.weather.lng=e.coords.longitude,s.SettingsController.data.weather.touched=!0,s.WeatherManager.loadWeather(),s.SettingsController.updateServer()},getImageForWeather:function(e){var t=parseInt(e);if(-1!==["rain"].indexOf(t))return"rain-day.png";if(-1!==["snow"].indexOf(t))return"snow-day.png";switch(e){case "sleet":return"sleet.png";case "cloudy":return"cloudy-day.png";case "partly-cloudy-night":return"partly-cloudy-night.png";case"partly-cloudy-day":return"partly-cloudy-day.png";case "clear-night":return"clear-night.png";case "clear-day":return"clear-day.png";case "wind":return"wind-day.png";default:return"clear-day.png"}},loadWeather:function(){var a=this,i=t(".btn-use-my-location"),o=t(".weather-container");o.find(".widget-error").remove(),t.simplerWeather({location:s.SettingsController.data.weather.lat+","+s.SettingsController.data.weather.lng,apikey:"28d340d6cd8b3ca73086e511f40f266e",unit:"f",success:function(t){var tzSplit=t.timezone.split("/");tzSplit = tzSplit.length > 1 ? tzSplit : ["",""];var country=tzSplit[0].replace("_", " "),city=tzSplit[1].replace("_", " ");i.text(s.SettingsController.data.weather.touched?"Refresh":"Use my location"),o.find(".weather-title").text(country+", "+city),o.find(".weather-image").show().attr("src","img/weather/"+a.getImageForWeather(t.icon)),o.find(".weather-text").text(t.currently),o.find(".temperature").show().find(".temp-num").text(Math.round(t.temp));var r,l=5,u=o.find(".weather-item-mock"),d=o.find(".weather-forecast");o.find(".weather-item:not(.weather-item-mock)").remove(),n.each(t.alt_data.daily.data,function(e){if(0==l--)return!1;(r=u.clone()).find(".item-day").text(['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][(new Date(e.time)).getDay()]),r.find(".item-image").attr("src","img/weather/"+a.getImageForWeather(e.icon)),r.find(".item-temp .temp-num").text(Math.round(e.temperatureHigh)),r.removeClass("weather-item-mock"),d.append(r)}),s.UI.Tippy.refresh(),e.ripple.registerRipples()},error:function(e){console.log(e);o.append('<div class="widget-error">Could not load the weather</div>'),o.find(".temperature, .weather-image").hide(),s.ErrorHandler.info("Weather","We encountered a problem getting the weather, try again in a few minutes."),t(".btn-use-my-location").text("Try again"),e.ripple.registerRipples()}})},fetchLocation:function(e,n){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e,n,{enableHighAccuracy:!1,timeout:3500,maximumAge:0}):(alert("Sorry, looks like your browser doesn't support geolocation"),t(".pure-button").removeClass("pure-button-primary").addClass("pure-button-success"))}},k={alarmSoundObj:null,data:{},defaultData:{tune_type:"tune",tune_data:{title:"Wacky Alarm",category:"funky",src:["audio/Wacky Alarm.mp3"],likes:1323,id:12}},updateServer:function(){p.isLoggedIn()&&m.POST("/update-tunes",{data:this.getData(),alarm_id:s.AlarmManager.getAlarmId()},function(){})},getMoodByCategory:function(e){switch(n.isArray(e)&&(e=(e=n.remove(e,function(e){return"top"!==e}))[0]),e.toLowerCase()){case"funky":return"feeling funky";case"soft":return"Softly";case"happy":return"Cheered up";case"jumpy":return"feeling jumpy";default:return"feeling great"}},isTune:function(){return"tune"===this.data.tune_type},isYouTube:function(){return"youtube"===this.data.tune_type},isRadio:function(){return"radio"===this.data.tune_type},isUpload:function(){return"upload"===this.data.tune_type},getGeneralTuneTitle:function(){return this.isTune()?this.data.tune_data.title:this.isYouTube()?this.data.tune_data.title:void 0},getGeneralTuneSourceArray:function(){return this.isTune()?this.data.tune_data.src:this.isYouTube()?this.data.tune_data.src:void 0},stopPlaying:function(){null!==this.alarmSoundObj&&this.alarmSoundObj.pause()},initAndPlay:function(t,a){null!==this.alarmSoundObj&&this.alarmSoundObj.unload();var i=t;this.alarmSoundObj=new e.Howl({src:n.isArray(i)?i:[i],loop:!0,autoplay:!0,onstop:function(){n.isFunction(a)&&a()},onload:function(){}})},init:function(e){t(".change-tune .box-view").on("click",function(){k.Dialog.open(s.TuneManager.data.tune_type,s.TuneManager.data.tune_data)}),s.EventManager.on("tuneChanged",function(e,t,n){var a="<div>"+function(e){switch(e){case"tune":return"Waking up to the tune";case"youtube":return"Waking up to the YouTube video";case"radio":return"Waking up to the Radio station";case"upload":return"Waking up to an uploaded tune"}}(n)+' <span style="font-weight: bold; color: #FFEB3B">'+t+"</span></div>";s.UI.SnackBar.show(a)}),this.applyData(e||this.defaultData)},getData:function(){return this.data},applyDataArgs:function(e,t){this.data.tune_type=e,this.data.tune_data=t,this._setGeneralTune(),s.SettingsController.syncTuneDupData()},applyData:function(e){this.data=n.merge(n.clone(this.defaultData,!0),e),this._setGeneralTune(),s.SettingsController.syncTuneDupData()},_setGeneralTune:function(){switch(this.data.tune_type){case"tune":this.setTune(this.data.tune_data);break;case"youtube":this.setYouTube(this.data.tune_data);break;case"radio":break;case"upload":this.setUpload(this.data.tune_data)}s.changed()},setYouTube:function(e){var n=t(".change-tune");n.find(".svg-tune-type").hide(),n.find(".svg-youtube").show(),n.find(".play-wrapper").hide(),n.find(".tune-title").text(e.title),n.find(".box-settings").addClass("show-info"),n.find(".title-cont .title").text("YouTube video"),n.find(".like-unlike-wrapper").hide()},setUpload:function(e){this.data.tune_data=e,this.data.tune_type="upload";var n=t(".change-tune");n.find(".play-wrapper").show(),n.find(".title-cont .title").text("Uploaded tune"),n.find(".tune-title").text(e);var a=s.User.getTuneBasePath()+e;n.find(".play-wrapper").data("src",a),n.find(".like-unlike-wrapper").hide(),n.find(".svg-tune-type").hide(),n.find(".svg-upload").show(),n.find(".box-settings").removeClass("show-info")},setTune:function(e){this.data.tune_data=e,this.data.tune_type="tune";var n=t(".change-tune");n.find(".play-wrapper").show(),n.find(".title-cont .title").text("Alarm tune"),n.find(".tune-title").text(this.getGeneralTuneTitle()),n.find(".play-wrapper").data("src",this.getGeneralTuneSourceArray());var a=n.find(".like-unlike-wrapper");a.show(),s.LikesController.updateDomData(a,e),n.find(".svg-tune-type").hide(),n.find(".svg-tune").show(),n.find(".box-settings").removeClass("show-info")},CurrentPlayingSound:{object:null,last_object_id:null,$dom:null,isActive:function(){return!n.isNull(this.$dom)&&!n.isNull(this.object)&&"unloaded"!==this.object.state()},setInactive:function(){n.isNull(this.object)||this.object.stop(),null!==this.$dom&&this.$dom.removeClass("playing"),this.object=null,this.$dom=null},isDom:function(e){return this.$dom.length==e.length&&e[0]===this.$dom[0]},stopCurrentPlayer:function(){null!==this.$dom&&this.$dom.removeClass("playing"),this.setInactive()},replaceAndStart:function(t,a,i,o){var r=this;n.isNull(r.object)||(r.object.unload(),this.setInactive()),r.object=new e.Howl({src:n.isArray(t)?t:[t],autoplay:!0,onstop:function(){n.isNull(r.object)?r.setInactive():0!==this._getSoundIds().length&&n.isFunction(o)&&o()},onload:function(){n.isNull(r.object)?this.unload():n.isFunction(i)&&i.apply()}}),r.last_object_id=r.object._getSoundIds(),r.$dom=a}},Dialog:{isOpen:!1,instance:null,openYouTubeVideo:function(e){this.open("youtube",e,function(){s.AjaxDialogs.TuneSelect.YouTube.chooseVideo(e)})},open:function(e,a,i){k.CurrentPlayingSound.setInactive(),o.load("partials/tune-select/style.css"),this.instance=t.alert({title:"",content:"url:partials/tune-select/tune-select.html",escapeKey:!0,columnClass:"alarm-sound-dialog",type:"blue",backgroundDismiss:!0,onContentReady:function(){setTimeout(function(){t(".jconfirm-box").removeClass("loading")},100),s.AjaxDialogs.TuneSelect.init(e,a,i)},buttons:{Close:{text:"Close",action:function(){t("#tab-tune").is(":checked")?s.AjaxDialogs.TuneSelect.Tune.saveSelection():t("#tab-youtube").is(":checked")?s.AjaxDialogs.TuneSelect.YouTube.saveSelection():t("#tab-radio").is(":checked")?s.AjaxDialogs.TuneSelect.Radio.saveSelection():t("#tab-upload").is(":checked")&&"Use uploaded file"===s.TuneManager.Dialog.instance.$$Close.text()&&s.AjaxDialogs.TuneSelect.Upload.saveSelection()}}},onClose:function(){if(s.TuneManager.CurrentPlayingSound.setInactive(),t("#tab-youtube").is(":checked")){var e=s.Utils.getYouTubePlayer("youtube-iframe");!n.isUndefined(e)&&e.hasOwnProperty("destroy")&&e.destroy()}},boxWidth:"500px",useBootstrap:!1})},close:function(){this.isOpen=!1,n.isNull(this.instance)||this.instance.close()}}},b={sortable:null,defaultData:[{text:"Eat some breakfast",priority:0,is_done:!1},{text:"This to-do must be important",priority:1,is_done:!1},{text:"Take over the world",priority:0,is_done:!0}],data:[],getData:function(){return this.data},applyData:function(e){this.data=e,this.data.length&&n.has(this.data[0],"listindex")&&(this.data=n.sortBy(this.data,function(e){return e.listindex}),n.each(this.data,function(e){delete e.listindex})),this._refreshTodosDom(),this._initSortable()},_getTodoIndexByDomIdentifier:function(e){return n.findIndex(this.data,function(t){return t.identifier===e.data("identifier")})},init:function(e){var a=this;this.applyData(e||this.defaultData),s.EventManager.on("todos.updated",function(){0===a.data.length?a.addWidgetError():a.removeWidgetError(),s.changed(),s.User.isLoggedIn()&&a.updateServer()}),0===this.data.length?a.addWidgetError():a.removeWidgetError(),t(".todo-container .svg-add").on("click",function(){if(a.data.length>=10)t.alert({title:"Oops, you can't add more",content:"Sorry, you only allowed to set up-to 10 to-dos.",escapeKey:!0,columnClass:"alarm-sound-dialog",type:"blue",backgroundDismiss:!0,boxWidth:"400px",useBootstrap:!1});else{var e={text:function(e){var t=["Like MetaClock on Facebook","Take over an alien ship","Don't show up late for work","Do that thing you forgot about","Be awesome, as usual","Try something new today","Use sunscreen"];return a.data.length&&n.remove(t,function(e){return e===a.data[a.data.length-1].text}),t[e]}(n.random(0,5)),priority:0,is_done:!1};a.data.push(e),a.removeWidgetError(),a._addDomItemFromJson(e,a.data.length-1),s.EventManager.emit("todos.updated");var i=document.getElementsByClassName("todo-list")[0];t(i).animate({scrollTop:i.scrollHeight-i.clientHeight},100)}})},_initSortable:function(){var a=this;this.sortable=new e.Sortable(t(".todo-list")[0],{delay:0,animation:120,filter:".mock-data-template",draggable:"li.list-item",ghostClass:"sortable-ghost",dataIdAttr:"data-id",fallbackClass:"sortable-fallback",fallbackTolerance:0,handle:".checkbox",scroll:!0,scrollSensitivity:30,scrollSpeed:10,onUpdate:function(e){var t=n.clone(a.data[e.oldIndex-1]);a.data.splice(e.oldIndex-1,1),a.data.splice(e.newIndex-1,0,t),s.EventManager.emit("todos.updated")}})},updateServer:function(){p.isLoggedIn()&&m.POST("/update-todos?async=true",s.getData(),function(){})},_clearListNodes:function(){t(".todo-list > li:not(.mock-data-template)").each(function(){t(this).remove()})},_showLoading:function(){},_refreshTodosDom:function(){var e=this;e._clearListNodes(),0===this.data.length?e.addWidgetError():(e.removeWidgetError(),n.each(this.data,function(t,n){e._addDomItemFromJson(t,n)}))},addWidgetError:function(){this.removeWidgetError(),t(".todo-container .todo-list").append('<div class="widget-error" style="color:#4d4343;line-height: 29px;font-size: 14px;">No to-dos<br /> Use the <svg class="" fill="#607D8B" width="18" height="18" viewBox="0 0 27 26" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>+</title><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="plus" fill="#607D8B"><polygon points="3 10.16 11.16 10.16 11.16 2 16.28 2 16.28 10.16 24.4 10.16 24.4 15.28 16.28 15.28 16.28 23.44 11.16 23.44 11.16 15.28 3 15.28"></polygon></g></g></svg> button to add a new to-do</div>')},removeWidgetError:function(){t(".todo-container .todo-list .widget-error").remove()},_addDomItemFromJson:function(e,a){var i,o,r,l=this,u=t(".todo-container .todo-list"),d=u.find("li.mock-data-template")[0].outerHTML,c="todo_"+a;o=(i=t(d).clone()).find(".checkbox-text"),(r=i.find("input[type=checkbox]")).attr("id",c),o.val(e.text),e.identifier=n.uniqueId("identifier_"),i.data("identifier",e.identifier),e.is_done&&(o.addClass("marked"),r.prop("checked",!0)),1===e.priority&&i.addClass("level-important"),i.removeClass("mock-data-template").removeAttr("data-item-sortable-id").removeAttr("role").removeAttr("aria-grabbed"),o.on("change",function(){var e=t(this),n=e.closest("li.list-item"),a=l._getTodoIndexByDomIdentifier(n);l.data[a].text=e.val(),s.EventManager.emit("todos.updated")}),r.on("change",function(){var e=t(this).closest("li.list-item"),n=e.find(".checkbox-text"),a=l._getTodoIndexByDomIdentifier(e);l.data[a].is_done=this.checked,n.toggleClass("marked",this.checked),s.EventManager.emit("todos.updated")}),i.find(".btn-delete").on("click",function(){var e=t(this).closest("li.list-item"),n=l._getTodoIndexByDomIdentifier(e);l.data.splice(n,1),e.remove(),s.EventManager.emit("todos.updated")}),i.find(".btn-swap-priority").on("click",function(){var e=t(this).closest("li.list-item"),n=l._getTodoIndexByDomIdentifier(e);l.data[n].priority=1===l.data[n].priority?0:1,1===l.data[n].priority?e.addClass("level-important"):e.removeClass("level-important"),s.EventManager.emit("todos.updated")}),u.append(i)}},w={$timePicker:null,_isTestMode:!1,data:{},defaultData:{pre_alarm:{did_set:!1,settings:null,time_setted:null,alarm_id:null,alarm_time:"08:00:00"},post_alarm:{did_wake_up:!1,snoozes_used:0},alarm_history:[]},setTestMode:function(e){this._isTestMode=e},isTestMode:function(){return this._isTestMode},setAlarmId:function(e){this.data.pre_alarm.alarm_id=e},hasAlarmId:function(){return null===this.data.pre_alarm.alarm_id},getAlarmId:function(){return this.data.pre_alarm.alarm_id},getMomentObjectFromUserTime:function(e,t){return a(t.format("YYYY-MM-DD")+" "+e,"YYYY-MM-DD "+this.getUserTimeFormat())},getSnoozesLeft:function(){return 0===s.SettingsController.data.clock.snooze_times?-1:s.SettingsController.data.clock.snooze_times-this.data.post_alarm.snoozes_used},haveSnoozesLeft:function(){if(0===s.SettingsController.data.clock.snooze_times)return!0;var e=s.SettingsController.data.clock.snooze_times;return this.data.post_alarm.snoozes_used<e},addToSnooze:function(e){this.data.post_alarm.snoozes_used+=e},Dom:{youtubePlayerObj:null,setDomFireMode:function(e){t(document).off("keydown.stopAlarm"),s.UI.DarkMode.toggle(!1),document.title="Social Alarm Clock - MetaClock.com",t(".night-day-mode-switch").find(".onoffswitch-checkbox").prop("checked",!0);var n=t(".app-content"),a=s.TuneManager.isYouTube(),i=this;t(".clock-container").removeClass("alarm-scheduled-mode").addClass("alarm-fired-mode"),t(".alarm-schedule-wrapper").hide(),n.addClass("alarm-fired").removeClass("alarm-init").removeClass("alarm-scheduled"),a?(t("#yt-frame-cont").show(),n.addClass("youtube-alarm")):(t("#yt-frame-cont").hide(),n.removeClass("youtube-alarm")),t(".btn-stop-alarm").one("click",function(){i.setInitMode(function(){i.afterAlarmCleanup()})}),setTimeout(function(){e.onShow()},600)},afterAlarmCleanup:function(){if(t(e).unbind("beforeunload.mc"),t(document).off("keydown.stopAlarm"),t(document).off("keydown.cancelAlarm"),s.UI.DarkMode.toggle(!1),document.title="Social Alarm Clock - MetaClock.com",s.AlarmManager.data.pre_alarm.did_set=!1,s.TuneManager.isTune())s.TuneManager.stopPlaying(),s.TuneManager.CurrentPlayingSound.setInactive();else if(s.TuneManager.isYouTube())try{n.isUndefined(s.Utils.getYouTubePlayer("yt-frame-cont"))||s.Utils.getYouTubePlayer("yt-frame-cont").stopVideo()}catch(e){r(e)}else s.TuneManager.isUpload()&&(s.TuneManager.stopPlaying(),s.TuneManager.CurrentPlayingSound.setInactive())},setDomAlarmMode:function(e){var a=t(".clock-container");s.TuneManager.isYouTube()?t(".info-youtube").show():t(".info-youtube").hide(),s.UI.DarkMode.toggle(!0);try{n.isUndefined(s.Utils.getYouTubePlayer("yt-frame-cont"))||s.Utils.getYouTubePlayer("yt-frame-cont").stopVideo()}catch(e){r(e)}l.setYouTubePlayer("yt-frame-cont",function(e){s.AlarmManager.Dom.youtubePlayerObj=e,e.cueVideoById(s.TuneManager.data.tune_data.id)}),a.addClass("alarm-scheduled-mode").removeClass("alarm-fired-mode"),a.find(".gm-title").text("Good morning"+(p.isLoggedIn()?", "+p.getFirstName():"")+"!");var i=t(".alarm-schedule-wrapper");i.hide(),t(".app-content").addClass("alarm-scheduled").removeClass("alarm-init").removeClass("alarm-fired"),setTimeout(function(){t(".alarm-state-init").hide(),i.fadeIn(),t(".alarm-state-schedule").show(),e.onShow()},600)},updateAlarmInputTime:function(e){w.$timePicker.val(e.format(w.getUserTimeFormat()))},updateAlarmInput:function(){var e=t(".clock-container"),n=s.SettingsController.isShowSeconds(),a=s.SettingsController.isMilitaryTime();e.toggleClass("ampm-time",!a),e.toggleClass("military-time",a),e.toggleClass("show-seconds",n),w.$timePicker.timeEntry("option",{show24Hours:a,showSeconds:n,timeSteps:[1,1,1],ampmPrefix:" "})},setInitMode:function(e){s.AlarmManager.Alarm._stop();var a=t(".clock-container");a.removeClass("alarm-scheduled-mode").removeClass("alarm-fired-mode"),t(".app-content").addClass("alarm-init").removeClass("alarm-scheduled").removeClass("alarm-fired"),setTimeout(function(){a.find(".alarm-state-schedule").fadeOut("fast"),a.find(".alarm-state-init").fadeIn("slow"),n.isFunction(e)&&e()},500),this.afterAlarmCleanup()},updateSnooze:function(e,n){e=parseInt(e),n=parseInt(n);var a=t(".snooze-form-wrapper"),i=a.find(".snooze-mins"),o=a.find(".snooze-times"),r=a.find(".snooze-x"),s=a.find(".snooze-every");0===e?(o.hide(),s.show(),r.hide()):(s.hide(),o.show().find("strong").text(e),r.show()),t("select.snooze-mins-select").val(n),t("select.snooze-times-select").val(e),i.text(n)}},getUserTimeFormat:function(){var e=s.SettingsController.isMilitaryTime(),t=(e?"HH":"hh")+":mm"+(s.SettingsController.isShowSeconds()?":ss":"");return e||(t+=" A"),t},applyData:function(e){this.data=n.merge(n.clone(this.defaultData,!0),e),this.data.post_alarm.did_wake_up=!1,this.data.pre_alarm.time_setted=null,this.data.pre_alarm.alarm_time=this.getMomentObjectFromUserTime(this.data.pre_alarm.alarm_time,a()),this.Dom.updateAlarmInputTime(this.data.pre_alarm.alarm_time),this.Dom.updateAlarmInput(),this.Dom.updateSnooze(s.SettingsController.data.clock.snooze_times,s.SettingsController.data.clock.snooze_duration)},initRecentAlarms:function(){this.data.hasOwnProperty("alarm_history")||(this.data.alarm_history=this.defaultData.alarm_history);var e=this.data.alarm_history,i=t(".widget-recent-alarms .ra-wrapper"),o=i.find(".mock-recent-alarm-item");if(i.find(".ra-item:not(.mock-recent-alarm-item)").remove(),0!==e.length){i.find(".widget-error").remove(),i.find(".widget-error").remove();var r=5,l=[];n.each(e,function(e){if(0==r--)return!1;if(!0!==l[e.alarm_time]){var n=o.clone();n.removeClass("mock-recent-alarm-item"),n.find(".clock-svg-cont");var u=s.AlarmManager.getMomentObjectFromUserTime(e.alarm_time,a());u=u.format(s.AlarmManager.getUserTimeFormat()),n.find(".ra-time .time").text(u);var d=s.AlarmManager.getMomentObjectFromUserTime(e.alarm_time,a());d=d.format(s.AlarmManager.getUserTimeFormat()),n.find(".clone-ra-item").on("click",function(){s.AlarmManager.$timePicker.val(d),s.AlarmManager.$timePicker.trigger("change"),s.UI.SnackBar.show("Your alarm time switched to "+d)}),n.find(".remove-ra-item").on("click",function(){var n=t(this);s.Backend.GET("/remove-recent-alarms?alarm_id="+e.id+"&user_id="+s.User.getUserId()).done(function(){n.closest(".ra-item").remove(),0===i.find(".ra-item:not(.mock-recent-alarm-item)").length&&i.append('<div class="widget-error" style="color:#4d4343;line-height: 29px;font-size: 14px;">No recent alarms</div>'),s.UI.SnackBar.show("Alarm time deleted: "+d)})}),l[e.alarm_time]=!0,i.append(n)}})}else i.find(".widget-error").length||i.append('<div class="widget-error" style="color:#4d4343;line-height: 29px;font-size: 14px;">No recent alarms</div>')},refreshRecentAlarms:function(){},init:function(e){this.$timePicker=t(".time-picker"),this.$timePicker.timeEntry({spinnerImage:""});var n=this;t(".clock .wake-me-up-at").on("click",function(){n.$timePicker.focus()}),this.$timePicker.on("click",function(e){e.stopPropagation()}),this.applyData(e||this.defaultData),this.initRecentAlarms(),s.EventManager.on("User.logged-in",this.initRecentAlarms.bind(this)),s.EventManager.on("Alarm.history.updated",this.initRecentAlarms.bind(this)),t(".snooze-form-wrapper .box-view").on("hover click",function(){t(this).parent().find("select")[0].focus()}),t(".btn-set-alarm").click(function(){s.GAnalytics.app("Alarm","Set"),n.data.pre_alarm.did_set=!0,n.setTestMode(!1),n.setAlarmMode({time:-1,isNewAlarm:!0})}),t(".btn-test-alarm").click(function(){s.GAnalytics.app("Alarm","Test"),n.setTestMode(!0),n.setAlarmMode({time:function(){return a().add(10,"second")},isNewAlarm:!0,isTest:!0})}),t("select.snooze-mins-select").on("change",function(){var e=t(this).val();n.Dom.updateSnooze(t("select.snooze-times-select").val(),e),s.SettingsController.data.clock.snooze_duration=e,s.changed(),s.SettingsController.updateServer()}),t("select.snooze-times-select").on("change",function(){var e=parseInt(t(this).val());n.Dom.updateSnooze(e,t("select.snooze-mins-select").val()),s.SettingsController.data.clock.snooze_times=e,s.changed(),s.SettingsController.updateServer()}),t(".snooze-form-wrapper").find(".onoffswitch-checkbox").on("change",function(){var e=t(this).is(":checked");s.SettingsController.changeSnoozeState(e),s.changed(),s.SettingsController.updateServer()}),t(".night-day-mode-switch").find(".onoffswitch-checkbox").on("change",function(){var e=t(this).is(":checked");s.UI.DarkMode.toggle(e)}),this.$timePicker.change(function(){var e=t(this).val();n.data.pre_alarm.alarm_time=n.getMomentObjectFromUserTime(e,a()),s.changed()}),t(".btn-cancel-alarm").bind("click.mc",this.cancelAlarmPrompt.bind(this)),s.EventManager.on("Alarm.snoozeChanged",function(){}),d.on("Alarm.stop",function(){n.Dom.setInitMode()}),d.on("Alarm.wakeUp",function(){n.setFireMode()})},cancelAlarmPromptKeyCodeEvent:function(e){if(27===e.keyCode&&!s.ErrorHandler.areDialogsOpen()){if(e.preventDefault(),s.ErrorHandler.areDialogsOpen())return;s.AlarmManager.cancelAlarmPrompt()}},cancelAlarmPrompt:function(){s.ErrorHandler.infoPrompt("Are you sure you want to cancel the alarm?",{button:"Yes",action:function(){s.AlarmManager.Dom.setInitMode(function(){s.AlarmManager.Dom.afterAlarmCleanup()})}},{button:"No"},"No|10000","Wait!")},getData:function(){var e=this.data,t=n.cloneDeep(e);return a.isMoment(t.pre_alarm.alarm_time)&&(t.pre_alarm.alarm_time=t.pre_alarm.alarm_time.format("HH:mm:ss")),a.isMoment(t.pre_alarm.time_setted)&&(t.pre_alarm.time_setted=t.pre_alarm.time_setted.format(l.getDateTimeFormat())),t},Alarm:{isActive:!1,timeObj:null,countdownTimer:null,titleCountdownTimer:null,didEndOnTime:!1,timer:null,isSet:function(){return this.isActive},_getHoursLeftFormat:function(e){e=void 0===e?"":e;var t,n,i=s.AlarmManager.Alarm.getDurationObject();return t=a.utc(i.asMilliseconds()).format(i.asMinutes()<60?"mm:ss":"HH:mm"),n=i.asHours()>1?"hours":i.asMinutes()>=1?"minutes":"seconds",t+" "+n+" "+e},set:function(e){this.timeObj=e;var n=this;if(clearTimeout(this.timer),clearInterval(this.countdownTimer),clearInterval(this.titleCountdownTimer),s.SettingsController.hasCountdown()){t(".waking-up-time-cont .hours-to-sleep").show();var a=function(){t(".time-left").text(s.AlarmManager.Alarm._getHoursLeftFormat())};a(),this.countdownTimer=setInterval(a,5e3)}else t(".waking-up-time-cont .hours-to-sleep").hide();if(s.TuneManager.isYouTube(),s.SettingsController.hasTitleCountdown()){var i=function(){document.title=s.AlarmManager.Alarm._getHoursLeftFormat("to wake up")};i(),this.countdownTimer=setInterval(i,1e3)}this.timer=setTimeout(function(){n._wakeUp()},n._getDuration()),this.isActive=!0,d.emit("Alarm.set")},_wakeUp:function(){this.didEndOnTime=!0,this._stop(),d.emit("Alarm.wakeUp")},stop:function(){this._stop(),d.emit("Alarm.stop")},_stop:function(){this.isActive=!1,clearTimeout(this.timer),this.timer=null,clearInterval(this.countdownTimer),this.countdownTimer=null},test:function(){},_getDuration:function(){var e=this.getDurationObject();return e<0&&(e=e.add(24,"hours")),e.asMilliseconds()},getDurationObject:function(){return a.duration(this.timeObj.diff())}},setAlarmMode:function(i){i.isTest=!n.isUndefined(i.isTest)&&i.isTest;var o=this;-1===i.time&&(i.time=o.data.pre_alarm.alarm_time),n.isObject(i.time)&&i.time instanceof a&&i.time.isBefore(a())&&i.time.add(1,"day");var r=function(){i.isNewAlarm&&(s.AlarmManager.data.post_alarm.snoozes_used=0),s.AlarmManager.data.pre_alarm.time_setted=a(),o.Dom.setDomAlarmMode({time:i.time,onShow:function(){t(e).unbind("beforeunload.mc").bind("beforeunload.mc",function(t){var n="Closing MetaClock tab may prevent the alarm from firing, please leave this tab open.";return(t||e.event).returnValue=n,n});var a=n.isFunction(i.time)?i.time():i.time;if(o.Alarm.set(a),t(".waking-up-time").text(a.format(s.AlarmManager.getUserTimeFormat())),s.TuneManager.CurrentPlayingSound.setInactive(),i.onShow=n.isFunction(i.onShow)?i.onShow:function(){},t(document).off("keydown.cancelAlarm").on("keydown.cancelAlarm",s.AlarmManager.cancelAlarmPromptKeyCodeEvent),o.isTestMode())return i.onShow();var r;i.isNewAlarm?(r=m.POST("/set-alarm",s.getData()).done(function(e){s.User.isLoggedIn()&&null!==e&&s.AlarmManager.setAlarmId(parseInt(e))})).fail(function(){}):(r=m.POST("/inc-snooze",s.getData()).done(function(e){n.isFunction(i.onShow)&&i.onShow()})).fail(function(){w.addToSnooze(-1)}),r.always(function(){i.onShow()})}})};p.isLoggedIn()||i.isTest||!i.isNewAlarm?r():s.ErrorHandler.loginPrompt("Connect with Facebook so we can remember your changes the next time you come by.",r,function(){s.setUnchanged(),r()},!0)},applyFireModeLogic:function(){if(t(document).off("keydown.cancelAlarm"),s.AlarmManager.data.post_alarm.did_wake_up=!0,t(document).off("keydown.stopAlarm").on("keydown.stopAlarm",function(e){27===e.keyCode&&(e.preventDefault(),s.AlarmManager.Dom.setInitMode(function(){s.AlarmManager.Dom.afterAlarmCleanup()}))}),s.SettingsController.hasTitleCountdown()&&(document.title="Social Alarm Clock - MetaClock"),!this.isTestMode()){var e=m.POST("/fire-alarm",s.getData()).done(function(e){s.AlarmManager.data.alarm_history=e,s.EventManager.emit("Alarm.history.updated")});e.fail(function(){}),e.always(function(){s.AlarmManager.data.post_alarm.did_wake_up=!1,s.JWUManager.fetch()})}},setFireMode:function(){var n=this;s.ErrorHandler.closeAll();var i=t(".alarm-state-fired");s.TuneManager.isTune()?(i.find(".song-title").text(s.TuneManager.getGeneralTuneTitle()),s.TuneManager.initAndPlay(s.TuneManager.data.tune_data.src,function(){}),l.destroyYouTubePlayer("yt-frame-cont"),t("#yt-frame-cont").hide()):s.TuneManager.isYouTube()?(t(".song-cont").hide(),t("#yt-frame-cont").show(),s.Utils.setYouTubePlayer("yt-frame-cont",function(e){e.loadVideoById(s.TuneManager.data.tune_data.id)})):s.TuneManager.isUpload()&&(i.find(".song-title").text(s.TuneManager.data.tune_data),s.TuneManager.initAndPlay(s.User.getTuneBasePath()+s.TuneManager.data.tune_data,function(){}),l.destroyYouTubePlayer("yt-frame-cont"),t("#yt-frame-cont").hide(),t(".song-cont").hide()),n.Dom.setDomFireMode({onShow:function(){t(document).off("keydown.cancelAlarm"),s.ErrorHandler.closeAll();var i=s.SettingsController.isSnoozeEnabled(),o=s.SettingsController.haveUnlimitedSnoozes();if(i&&(o||s.AlarmManager.haveSnoozesLeft())){var r=s.AlarmManager.getSnoozesLeft(),l=parseInt(s.SettingsController.getSnoozesDuration()/60),u=function(e){32==e.keyCode&&e.preventDefault()};s.AlarmManager.addToSnooze(1),s.AlarmManager.haveSnoozesLeft();var d=t.confirm({title:!1,icon:"tomerlucky",content:'<div><svg fill="#f1c410" height="40" viewBox="0 0 24 24" width="40" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm-3-9h3.63L9 15.2V17h6v-2h-3.63L15 10.8V9H9v2z"></path></svg><div style="display: inline-block;font-size: 23px;vertical-align: -3px;margin-left: 8px;color: #FF9800;">Snooze!</div><div style="position: absolute;top: 12px;font-weight: 300;right: 16px;font-size: 13px;'+(o?"display:none":"")+'">You have <strong>'+(r-1==0?"no snoozes":r-1==1?"1 snooze":r-1+" snoozes")+'</strong> left.</div><div style="padding-top: 15px;font-weight: 300;padding-bottom: 5px;padding-left: 8px;font-size: 13px;">Click <strong>Snooze</strong> to sleep '+l+" more minutes<br /> Click <strong>ESC</strong> to dismiss snooze.</div></div>",escapeKey:"Close",onClose:function(){e.removeEventListener("keydown",u)},onContentReady:function(){},buttons:function(t){var i={};return i.Snooze={keys:["space"],text:"Snooze [SPACE]",action:function(){n.Dom.afterAlarmCleanup(),s.AlarmManager.setAlarmMode({time:function(){return a().add(s.SettingsController.getSnoozesDuration(),"second")},isNewAlarm:!1}),d.close()}},i.Close={text:"Dismiss [ESC]",action:function(){d.close(),n.applyFireModeLogic()}},e.addEventListener("keydown",u),i}(),closeIcon:!1,type:"orange",backgroundDismiss:"Close",boxWidth:"450px",useBootstrap:!1})}else n.applyFireModeLogic()}})}},_={data:{},defaultData:{clock:{show_seconds:!1,military_time:!0,has_snooze:!0,snooze_times:0,snooze_duration:5},todos:{is_folded:!1},alarm:{title_countdown:!0,countdown:!0,action:"http://www.gmail.com",is_action_active:!1,desktop_notifications:!1},tune:{youtube_video:{title:"MetaClock - Your Online Alarm Clock",id:"T0VLuLzIrH8",img:"https://i.ytimg.com/vi/T0VLuLzIrH8/default.jpg"},tune_dup:{tune_type:"tune",tune_data:{title:"Wacky Alarm",category:"funky",src:["audio/Wacky Alarm.mp3"],likes:1323,id:12}}},weather:{lat:40.712784,lng:-74.005941,touched:!1},background:{type:"default",data:{}}},BGManager:{_autoTimer:null,_autoTimerCurrentCss:null,_timeDayTimer:null,data:null,type:null,_setAuto:function(){clearInterval(this._autoTimer);var e=function(){var e=parseInt(a().format("H")),n=function(e){s.SettingsController.BGManager._autoTimerCurrentCss!==e&&(t("link[href*='/css/skins/skin.']").remove(),s.Utils.getManyCss(["/css/skins/skin."+e+".css"],function(){s.SettingsController.BGManager._autoTimerCurrentCss=e}))};e>6&&e<10?n("sunrise"):e>10&&e<14?n("day"):e>14&&e<19?n("dusk"):e>19&&e<21?n("sunset"):(e>21||e<6)&&n("night")};this._autoTimer=setInterval(e,1e4),e()},apply:function(e,a){switch(t("link[href*='/css/skins/skin.']").remove(),this._autoTimerCurrentCss=null,null!==e&&this._cleanUp(),e){case"slideshow":var i=function(){var e=n.shuffle(["astronouts-drinks-beer.jpg","bird-orange-background.jpg","black-stone-water.jpg","black-white-tiger.jpg","boat-in-bottle.jpg","cat-look-at-fish.jpg","cat-shouts.jpg","chinese-scenery.jpg","ciel.jpg","cracky-floor.jpg","dusk-wallpaper.jpg","forest-waterfall.jpg","man-in-lake-forest.jpg","nature-house-trees.jpg","neurons-kiss.jpg","planet-earth-float.jpg","road-and-mountains.jpg","sun-and-grass.jpg","tree-in-wind.jpg","trees-and-sunlight.jpg","vector-lake-and-grass.jpg","water-house-mountains.jpg","water-path-with-trees.jpg","waterful-landscape.jpg"])[0];t("#page-bg").css("background-image",'url("img/backgrounds/'+e+'")')};i(),this._autoTimer=setInterval(i,27e5);break;case"default":t("#page-bg").css("background-image",'url("img/landscape/day.png")');break;case"auto":this._setAuto();break;case"list":t("#page-bg").css("background-image",'url("img/backgrounds/'+a.url+'")');break;case"url":t("#page-bg").css("background-image",'url("'+a.url+'")')}},_cleanUp:function(){clearInterval(this._autoTimer),clearInterval(this._timeDayTimer)}},isBackgroundAuto:function(){return"auto"===this.data.background.type},isBackgroundList:function(){return"list"===this.data.background.type},isBackgroundDefault:function(){return"default"===this.data.background.type},isBackgroundUrl:function(){return"url"===this.data.background.type},isBackgroundSlideShow:function(){return"slideshow"===this.data.background.type},setBackground:function(e,t){this.data.background.type=e,this.data.background.data=t,this.BGManager.apply(e,t)},getBackgroundType:function(){return this.data.background.type},getBackgroundData:function(){return this.data.background.data},hasTitleCountdown:function(){return this.data.alarm.title_countdown},setTitleCountdown:function(e){this.data.alarm.title_countdown=e},hasCountdown:function(){return this.data.alarm.countdown},setCountdown:function(e){this.data.alarm.countdown=e},setTodosFoldedState:function(e){this.data.todos.is_folded=e},syncTuneDupData:function(){this.data.tune.tune_dup=s.TuneManager.getData()},changeSnoozeState:function(e){this.data.clock.has_snooze=e;var n=t(".snooze-form-wrapper");e?(n.addClass("snooze-on").removeClass("snooze-off"),n.find(".onoffswitch-checkbox").prop("checked",!0)):(n.addClass("snooze-off").removeClass("snooze-on"),n.find(".onoffswitch-checkbox").prop("checked",!1))},isSnoozeEnabled:function(){return this.data.clock.has_snooze},hasDesktopNotifications:function(){return this.data.alarm.desktop_notifications},grantPermissionDesktopNotifications:function(e){"granted"!==Notification.permission&&Notification.requestPermission(e)},isActionActive:function(){return this.data.alarm.is_action_active},getAction:function(){return this.data.alarm.action},showDesktopNotification:function(){var e=function(){new Notification("Time to wake up!",{icon:"https://www.metaclock.com/img/clock.png",body:"Your alarm time is due."}).onclick=function(){r("Notification clicked")}};"granted"!==Notification.permission?Notification.requestPermission(e):e()},haveUnlimitedSnoozes:function(){return 0===s.SettingsController.data.clock.snooze_times},setYouTubeVideoData:function(e){s.SettingsController.data.tune.youtube_video=e},getSnoozesDuration:function(){return 60*this.data.clock.snooze_duration},isMilitaryTime:function(){return this.data.clock.military_time},isShowSeconds:function(){return this.data.clock.show_seconds},getData:function(){return this.data},applyData:function(e){this.data=n.merge(n.clone(this.defaultData,!0),e),this.data=l.fixJson(this.data,["clock.show_seconds","clock.military_time","clock.has_snooze","alarm.title_countdown","alarm.countdown","alarm.is_action_active","alarm.desktop_notifications","todos.is_folded"],function(e){return n.isBoolean(e)?e:"false"!==e}),this.data=l.fixJson(this.data,["clock.snooze_times","clock.snooze_duration"],function(e){return parseInt(e)}),this.changeSnoozeState(this.data.clock.has_snooze),this.BGManager.apply(this.getBackgroundType(),this.getBackgroundData())},updateServer:function(){p.isLoggedIn()&&m.POST("/update-settings?async=true",{user:s.User.getData(),settings:this.data},function(){})},init:function(n){var a=this;this.applyData(n||this.defaultData),t(".btn-alarm-settings").on("click",function(){a.Dialog.open()}),a.hasDesktopNotifications()&&a.grantPermissionDesktopNotifications(),d.on("Alarm.wakeUp",function(){a.hasDesktopNotifications()&&a.showDesktopNotification(),a.isActionActive()&&""!==a.getAction().trim()&&s.Utils.isValidURL(a.getAction().trim())&&(s.SettingsController.isSnoozeEnabled()&&0===s.AlarmManager.getSnoozesLeft()||!s.SettingsController.isSnoozeEnabled())&&e.open(a.getAction())})},Dialog:{isOpen:!1,instance:null,open:function(){var a=this;o.load("partials/settings/style.css"),this.isOpen=!0,n.isNull(this.instance)?this.instance=t.alert({title:"",content:"url:partials/settings/settings.html",escapeKey:!0,columnClass:"alarm-sound-dialog",type:"blue",buttons:{Ok:{text:"Dismiss",action:function(){a.instance.close()}}},backgroundDismiss:!0,onContentReady:function(){s.AjaxDialogs.Settings.init(),s.GAnalytics.app("Settings","open"),e.ripple.registerRipples()},boxWidth:"750px",useBootstrap:!1}):this.instance.open()},close:function(){this.isOpen=!1,n.isNull(this.instance)||this.instance.close()}}},D={openDialogs:[],loginPrompt:function(e,t,n,a){return a=void 0!==a&&a,this.infoPrompt("<strong>You are not logged-in.</strong>. <br /> <br /> "+e,{button:"Connect",action:function(){p.login(void 0,t)}},{button:a?"Skip":"Cancel",action:n}),prompt},areDialogsOpen:function(){var e=!1;return n.each(this.openDialogs,function(t){t.isOpen()&&(e=!0)}),e},error:function(e){var n=t.alert({title:"Oops",content:e,escapeKey:!0,type:"red",backgroundDismiss:!0,boxWidth:"500px",useBootstrap:!1});return this.openDialogs.push(n),prompt},info:function(e,n){var a=t.alert({title:e,content:n,escapeKey:!0,type:"orange",backgroundDismiss:!0,boxWidth:"500px",useBootstrap:!1});return this.openDialogs.push(a),prompt},errorPrompt:function(e,a,i){var o=t.confirm({escapeKey:!1,type:"red",backgroundDismiss:!1,boxWidth:"370px",useBootstrap:!1,title:"Oops",content:e,buttons:{ok:n.isFunction(a.action)?a:function(){},Cancel:n.isFunction(i.action)?i:function(){}}});return this.openDialogs.push(o),o},infoPrompt:function(e,a,i,o,r){var s={};s[a.button]=n.isFunction(a.action)?a.action:function(){},s[i.button]=n.isFunction(i.action)?i.action:function(){};var l=t.confirm({escapeKey:!1,title:void 0===r?"Oops":r,type:"orange",backgroundDismiss:!1,boxWidth:"370px",autoClose:void 0!==o&&o,useBootstrap:!1,content:e,buttons:s});return this.openDialogs.push(l),l},closeAll:function(){n.each(this.openDialogs,function(e){e.close()})}};t(document).ready(function(){e.App={ErrorHandler:D,TodoManager:b,AlarmManager:w,TuneManager:k,WeatherManager:v,SettingsController:_,LikesController:y,UI:u,QuoteManager:h,JWUManager:g,CantSleepBox:f,User:p,Backend:m,GAnalytics:c,EventManager:d,AjaxDialogs:{},Utils:l,_hasChanged:!1,changed:function(){this._hasChanged=!0},setUnchanged:function(){this._hasChanged=!1},hasChanged:function(){return this._hasChanged},start:function(){var n=e.userSettings;delete e.userSettings,e.screenfull.enabled||t(".full-screen-btn").hide(),this.QuoteManager.init(),this.JWUManager.init(),this.LikesController.init(),this.User.init(n&&n.user),this.SettingsController.init(n&&n.settings),this.TodoManager.init(n&&n.todos),this.AlarmManager.init(n&&n.alarm),this.TuneManager.init(n&&n.tune),this.WeatherManager.init(),this.CantSleepBox.init(),this.UI.init(),void 0===e.isFbInit||this.User.isLoggedIn()||(this.initFbUser(),delete e.isFbInit)},initFbUser:function(){this.User.isLoggedIn()||this.User.login(void 0,function(){r("callback POWER")},!1)},setData:function(e){this.User.applyData(e&&e.user),this.TodoManager.applyData(e&&e.todos),this.SettingsController.applyData(e&&e.settings),this.AlarmManager.applyData(e&&e.alarm),this.TuneManager.applyData(e&&e.tune)},getData:function(){return n.merge({todo:this.TodoManager.getData(),user:this.User.getData(),alarms:this.AlarmManager.getData(),tune:this.TuneManager.getData(),settings:this.SettingsController.getData()})}},s=e.App;try{s.start()}catch(t){e.fatal(t),s.ErrorHandler.errorPrompt("Sorry, looks like we got confused. Refreshing the page might help us to get back on track.",function(){s.Backend.GET("/complete-logout").done(function(){e.location.reload()})},function(){}),s.GAnalytics.app("Exception","Fatal")}})}(window,window.$,window._,window.moment,window.tippy,window.ljs,window.dbg);